<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chord Spelling Reveal — Major & Minor</title>
<style>
:root{
  --bg:#0e1117; --panel:#0f1422; --line:#2a2f3a; --muted:#b7bdc9;
  --card:#171c2a; --edge:#2c3344; --blue:#4c8fff; --ok:#6dff9b; --warn:#ff786c;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:#e6e8ee}
header{padding:12px 16px;border-bottom:1px solid var(--line);background:var(--panel);position:sticky;top:0;z-index:5;display:flex;align-items:center;justify-content:space-between;gap:12px}
h1{margin:0;font-size:18px;letter-spacing:.2px}

.wrap{max-width:980px;margin:14px auto 44px auto;padding:0 12px}
.card{background:var(--card);border:1px solid var(--edge);border-radius:14px;overflow:hidden}
.controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--edge)}
.controls .left{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
label{display:flex;align-items:center;gap:6px;background:#0f1422;border:1px solid #2a3147;border-radius:10px;padding:8px 10px;color:var(--muted)}
select{background:transparent;border:none;color:#e6e8ee;outline:none;min-width:80px}
button{background:var(--blue);color:#fff;border:none;border-radius:10px;padding:8px 12px;cursor:pointer;font-weight:700}
button.ghost{background:transparent;border:1px solid #3b4580;color:#b7c5ff}
button:disabled{opacity:.55;cursor:not-allowed}
.homeBtn{display:inline-flex;align-items:center;gap:8px;background:transparent;border:1px solid #3b4580;color:#b7c5ff;border-radius:10px;padding:8px 12px;text-decoration:none;font-weight:800}
.homeBtn:hover{border-color:#5a6ad6}

.body{padding:14px}
.promptLabel{color:var(--muted);font-size:12px}
.prompt{margin-top:4px;font-size:28px;font-weight:900;letter-spacing:.2px}

.slots{display:grid;grid-template-columns:repeat(3, minmax(0,1fr));gap:10px;margin-top:14px}
.slot{
  background:#0f1422;border:1px solid #2a3147;border-radius:14px;
  padding:16px 10px; text-align:center; font-weight:900; font-size:26px;
  cursor:pointer; user-select:none;
}
.slot.revealed{border-color:#2a8a4d; box-shadow:0 0 0 2px rgba(109,255,155,.12)}
.slot:hover{border-color:#3b4580}
.slot:active{transform:translateY(1px)}
.slot.disabled{opacity:.7; cursor:not-allowed}

.hint{margin-top:10px;color:var(--muted);font-size:13px;line-height:1.35}
.hint kbd{
  display:inline-block;padding:2px 6px;border:1px solid #3b4580;border-radius:6px;
  font-size:12px;background:#111522;color:#cfe7ff
}

.footer{
  display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;
  padding:12px 14px;border-top:1px solid var(--edge);color:var(--muted)
}
.kpi{display:flex;gap:14px;flex-wrap:wrap}
.kpi b{color:#e6e8ee}

.pills{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.pill{background:#0f1422;border:1px solid #2a3147;border-radius:999px;padding:6px 10px;font-size:12px}
.pill.ok{border-color:#2a8a4d;color:#c9ffd7}

@media (max-width:640px){
  .prompt{font-size:24px}
  .slot{font-size:24px}
  .controls{gap:8px}
}
</style>
</head>
<body>
<header>
  <h1>Chord Spelling Reveal</h1>
  <a class="homeBtn" href="./index.html">← Home</a>
</header>

<div class="wrap">
  <div class="card">
    <div class="controls">
      <div class="left">
        <label>Root
          <select id="rootSel"></select>
        </label>
        <label>Quality
          <select id="qualSel">
            <option value="both" selected>Random (Maj/Min)</option>
            <option value="maj">Major only</option>
            <option value="min">Minor only</option>
          </select>
        </label>
        <label>Accidentals
          <select id="accSel">
            <option value="auto" selected>Auto</option>
            <option value="sharps">Prefer sharps</option>
            <option value="flats">Prefer flats</option>
          </select>
        </label>
      </div>
      <div class="right">
        <button id="newBtn">New Chord</button>
        <button id="resetBtn" class="ghost">Reset Stats</button>
      </div>
    </div>

    <div class="body">
      <div class="promptLabel">Prompt</div>
      <div id="prompt" class="prompt">—</div>

      <div class="slots" id="slots">
        <div class="slot" data-idx="0">?</div>
        <div class="slot disabled" data-idx="1">?</div>
        <div class="slot disabled" data-idx="2">?</div>
      </div>

      <div class="hint">
        Click the boxes to reveal in order: <b>Root → 3rd → 5th</b>.
        Keyboard: <kbd>1</kbd> <kbd>2</kbd> <kbd>3</kbd> reveal, <kbd>N</kbd> new chord.
      </div>
    </div>

    <div class="footer">
      <div class="kpi">
        <span>Chords <b id="kChords">0</b></span>
        <span>Reveals <b id="kReveals">0</b></span>
      </div>
      <div class="pills">
        <span class="pill ok">Fixed order</span>
        <span class="pill">Click-to-reveal</span>
      </div>
    </div>
  </div>
</div>

<script>
const ROOTS = ["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"];
const PC = {"C":0,"C#":1,"Db":1,"D":2,"D#":3,"Eb":3,"E":4,"F":5,"F#":6,"Gb":6,"G":7,"G#":8,"Ab":8,"A":9,"A#":10,"Bb":10,"B":11};

const CHROM_SHARPS = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
const CHROM_FLATS  = ["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];

function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function namingModeForRoot(root){
  if(root.includes("b")) return "flats";
  if(root.includes("#")) return "sharps";
  return "sharps";
}
function pcToName(pc, mode){
  const a = (mode==="flats") ? CHROM_FLATS : CHROM_SHARPS;
  return a[(pc+12)%12];
}

const rootSel = document.getElementById("rootSel");
const qualSel = document.getElementById("qualSel");
const accSel  = document.getElementById("accSel");
const promptEl= document.getElementById("prompt");
const slotEls = [...document.querySelectorAll(".slot")];

const kChords  = document.getElementById("kChords");
const kReveals = document.getElementById("kReveals");

let state = {
  chordCount: 0,
  revealCount: 0,
  chord: null,      // {label, notes:[n1,n2,n3]}
  revealed: 0       // 0..3
};

function buildRootSelect(){
  rootSel.innerHTML = "";
  const optRand = document.createElement("option");
  optRand.value = "random";
  optRand.textContent = "Random";
  rootSel.appendChild(optRand);

  ROOTS.forEach(r=>{
    const o = document.createElement("option");
    o.value = r; o.textContent = r;
    rootSel.appendChild(o);
  });
  rootSel.value = "random";
}

function makeChord(){
  const root = (rootSel.value === "random") ? pick(ROOTS) : rootSel.value;
  const qualMode = qualSel.value;
  const qual = (qualMode === "both") ? pick(["maj","min"]) : qualMode;

  const accPref = accSel.value;
  const nameMode = (accPref === "auto") ? namingModeForRoot(root) : accPref;

  const rPc = PC[root];
  const ints = (qual === "maj") ? [0,4,7] : [0,3,7];
  const pcs  = ints.map(i => (rPc + i) % 12);

  const notes = pcs.map(p => pcToName(p, nameMode));
  const label = `${root} ${qual === "maj" ? "major" : "minor"}`;

  return { label, notes };
}

function newChord(){
  state.chord = makeChord();
  state.revealed = 0;
  state.chordCount += 1;

  promptEl.textContent = state.chord.label;

  slotEls.forEach((s,i)=>{
    s.textContent = "?";
    s.classList.remove("revealed");
    s.classList.toggle("disabled", i !== 0);
  });

  syncKpis();
}

function revealIdx(idx){
  if(!state.chord) return;
  if(idx !== state.revealed) return;
  const el = slotEls[idx];
  if(el.classList.contains("disabled")) return;

  el.textContent = state.chord.notes[idx];
  el.classList.add("revealed");

  state.revealed += 1;
  state.revealCount += 1;

  if(state.revealed < 3){
    slotEls[state.revealed].classList.remove("disabled");
  }
  syncKpis();
}

function syncKpis(){
  kChords.textContent = String(state.chordCount);
  kReveals.textContent = String(state.revealCount);
}

function resetStats(){
  state.chordCount = 0;
  state.revealCount = 0;
  syncKpis();
}

slotEls.forEach(el=>{
  el.addEventListener("click", ()=>{
    const idx = parseInt(el.dataset.idx, 10);
    revealIdx(idx);
  });
});

document.getElementById("newBtn").addEventListener("click", newChord);
document.getElementById("resetBtn").addEventListener("click", resetStats);

document.addEventListener("keydown", (e)=>{
  const k = e.key.toLowerCase();
  if(k === "n"){ newChord(); }
  if(k === "1"){ revealIdx(0); }
  if(k === "2"){ revealIdx(1); }
  if(k === "3"){ revealIdx(2); }
});

buildRootSelect();
newChord();
</script>
</body>
</html>
